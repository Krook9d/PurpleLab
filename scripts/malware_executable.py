import subprocess
import sys
import os

def execute_virtualbox_command(file_name):
    file_path = f"C:\\Users\\oem\\Documents\\samples\\{file_name}"
    extension = os.path.splitext(file_name)[1].lower()

    # Command initialization for each extension type
    if extension in ['.exe', '.dll', '.bin']:
        command = [
            "VBoxManage",
            "guestcontrol",
            "sandbox",
            "run",
            "--exe",
            file_path,
            "--username",
            "oem",
            "--password",
            "oem",
            "--"
        ]
    elif extension == '.py':
        # Command initialization for Python files
        command = [
            "VBoxManage",
            "guestcontrol",
            "sandbox",
            "run",
            "--exe",
            "C:\\Python39\\python.exe",
            "--",
            file_path,
            "--username",
            "oem",
            "--password",
            "oem",
            "--"
        ]
    elif extension == '.ps1':
        # Building the PowerShell command
        ps_command = f"& {{Start-Process powershell -ArgumentList '-ExecutionPolicy Bypass -File {file_path}' -Verb RunAs}}"
        # Command initialization for PowerShell scripts
        command = [
            "VBoxManage",
            "guestcontrol",
            "sandbox",
            "run",
            "--exe",
            "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
            "--username",
            "oem",
            "--password",
            "oem",
            "--",
            "-Command",
            ps_command
        ]


    elif extension in ['.docx', '.xlsx', '.ods']:
        # Path to the LibreOffice executable (adjust if necessary)
        libreoffice_path = "C:\\\\Program Files\\\\LibreOffice\\\\program\\\\soffice.exe"
    
        # Command to run the file with LibreOffice
        command = [
            "VBoxManage",
            "guestcontrol",
            "sandbox",
            "run",
            "--username", "oem",
            "--password", "oem",
            "--exe", libreoffice_path,
            "--",
            "--writer", "--calc", "--impress", "--draw", file_path
        ]


    elif extension == '.pdf':
   
        acrobat_path = "C:\\Program Files\\Adobe\\Acrobat DC\\Acrobat\\Acrobat.exe"

        command = [
            "VBoxManage",
            "guestcontrol",
            "sandbox",
            "run",
            "--username", "oem",
            "--password", "oem",
            "--exe", acrobat_path,
            "--",
            file_path
        ]

    else:
        print(f"Unsupported file extension : {extension}", file=sys.stderr)
        return

    try:
        subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        print(f"Command executed for file {file_name}")
    except Exception as e:
        print(f"An unexpected error has occurred : {e}", file=sys.stderr)

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python sample_executable.py <file_name>", file=sys.stderr)
        sys.exit(1)

    file_name = sys.argv[1]
    execute_virtualbox_command(file_name)
